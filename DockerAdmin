FROM node:15.1 as frontend

# Install Yarn
#RUN curl -o- -L https://yarnpkg.com/install.sh | bash

# Create app directory
RUN mkdir -p /usr/src/app
WORKDIR /usr/src/app

# Copy app dependency files
COPY package.json yarn.lock /usr/src/app/

# Install packages and link to tmp file
RUN cd /usr/src/app && yarn -g

FROM node:15.1 as app
RUN mkdir -p /usr/src/app
WORKDIR /usr/src/app
COPY --from=frontend /usr/src/app/node_modules /usr/src/app/node_modules

#RUN cd /usr/src/app && ln -s /tmp/node_modules

# Bundle app source
COPY . /usr/src/app
RUN cd /usr/src/app && rm -rf dashboard/public
RUN cd /usr/src/app && cp public -R dashboard/public
RUN cd /usr/src/app && yarn build:admin-prod
EXPOSE 3000
CMD ["yarn", "start:admin"]
